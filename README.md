# ZDefender üõ°Ô∏è

[![Rust](https://img.shields.io/badge/language-Rust-orange.svg)](https://www.rust-lang.org/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Version](https://img.shields.io/badge/version-0.1.3-blue.svg)]()

**ZDefender** est un syst√®me avanc√© de protection contre les attaques DDoS pour les applications Linux. Il fournit une solution compl√®te pour d√©tecter et att√©nuer les menaces r√©seau en temps r√©el.

<p align="center">
  <img src="https://github.com/ceketrumdev/Zdefender/blob/master/Zdefenderlogo.png" alt="ZDefender Logo" width="1024" height="343" />
</p>

## üìã Table des mati√®res

- [Fonctionnalit√©s](#-fonctionnalit√©s)
- [Types d'attaques d√©tect√©s](#-types-dattaques-d√©tect√©s)
- [Architecture](#-architecture)
- [Installation](#-installation)
- [Configuration](#-configuration)
- [Journalisation](#-journalisation)
- [Utilisation](#-utilisation)
  - [Interface CLI](#interface-cli)
  - [Biblioth√®que](#biblioth√®que)
- [Comparer avec d'autres solutions](#-comparer-avec-dautres-solutions)
- [Licence](#-licence)

## ‚ú® Fonctionnalit√©s

- **üîç D√©tection multi-couches**: Analyse sophistiqu√©e des paquets et statistiques de trafic
- **üè∞ Mode forteresse am√©lior√©**: Protection renforc√©e avec whitelist automatique pour les connexions √©tablies
- **üö´ Blocage intelligent**: Dur√©e de blocage adapt√©e selon la gravit√© de l'attaque
- **‚öñÔ∏è Limitation de d√©bit**: R√©gulation du flux pour les comportements suspects
- **üìä Statistiques en temps r√©el**: Visualisation des m√©triques de s√©curit√© et connexions √©tablies
- **üíØ Syst√®me de confiance des IPs**: Score calcul√© en fonction du comportement, r√©gion et historique
- **üìù Journalisation flexible**: Support des fichiers de logs classiques et systemd-journal
- **‚öôÔ∏è Configuration facile**: Options configurables via fichier JSON
- **üîÑ Mode passif/actif**: Fonctionnement en mode d√©tection seule ou avec mitigation active
- **üîí S√©curisation automatique**: Commande pour verrouiller rapidement le serveur en cas d'urgence

## üõ°Ô∏è Types d'attaques d√©tect√©s

| Type d'attaque | Description | M√©thode de d√©tection |
|---------------|-------------|----------------------|
| SYN Flood     | Saturation par paquets SYN | Analyse de ratio SYN/ACK |
| ICMP Flood    | Saturation par pings | Comptage de paquets ICMP |
| UDP Flood     | Saturation par paquets UDP | Analyse volum√©trique |
| DNS Amplification | Amplification par serveurs DNS | Analyse de trafic DNS |
| Scan de ports | Tentatives de d√©couverte de services | D√©tection de connexions multiples |
| Fragmentation | Attaques par fragmentation de paquets | Analyse de fragments |
| Comportements anormaux | Toute d√©viation des mod√®les normaux | Analyses statistiques |

## üèóÔ∏è Architecture

Le syst√®me est structur√© en modules sp√©cialis√©s:

```
zdefender/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ models.rs       # Structures de donn√©es fondamentales
‚îÇ   ‚îú‚îÄ‚îÄ log_mode.rs     # Configuration des modes de journalisation
‚îÇ   ‚îú‚îÄ‚îÄ logger.rs       # Gestion de la journalisation
‚îÇ   ‚îú‚îÄ‚îÄ config.rs       # Configuration et param√®tres
‚îÇ   ‚îú‚îÄ‚îÄ protection.rs   # Coordination des strat√©gies de protection
‚îÇ   ‚îú‚îÄ‚îÄ analyzer.rs     # Analyse du trafic et d√©tection des attaques
‚îÇ   ‚îú‚îÄ‚îÄ packet_inspection.rs  # Inspection profonde des paquets
‚îÇ   ‚îú‚îÄ‚îÄ detect_attacks.rs     # Algorithmes de d√©tection
‚îÇ   ‚îú‚îÄ‚îÄ defender.rs     # Actions de d√©fense et gestion des connexions √©tablies
‚îÇ   ‚îú‚îÄ‚îÄ service.rs      # Gestion du service et statistiques en temps r√©el
‚îÇ   ‚îî‚îÄ‚îÄ main.rs         # Point d'entr√©e et CLI
‚îî‚îÄ‚îÄ ...
```

## üöÄ Installation

### Pr√©requis

- Syst√®me Linux (test√© sur Ubuntu 20.04+, Debian 11+, CentOS 8+)
- Rust 1.56+ (pour compilation)
- libpcap-dev
- build-essential

### Installation automatique

```bash
# Cloner le d√©p√¥t
git clone https://github.com/ceketrumdev/Zdefender.git
cd zdefender

# Installer le service (requiert les droits d'administrateur)
sudo ./install.sh

# V√©rifier le statut du service
sudo systemctl status zdefender
```

### Installation manuelle

```bash
# Compiler le projet (sans support systemd)
cargo build --release

# Compiler avec support systemd-journal
cargo build --release --features systemd

# Copier le binaire
sudo cp target/release/zdefender /usr/local/bin/

# Cr√©er le r√©pertoire de configuration
sudo mkdir -p /etc/zdefender

# Copier la configuration par d√©faut
sudo cp config/default.json /etc/zdefender/config.json

# Installer le service systemd
sudo cp config/zdefender.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable zdefender
sudo systemctl start zdefender
```

## ‚öôÔ∏è Configuration

Le fichier de configuration se trouve √† `/etc/zdefender/config.json` :

```json
{
  "interfaces": ["eth0"],
  "packet_threshold": 1000,
  "check_interval": 5,
  "block_duration": 300,
  "log_file": "/var/log/zdefender/zdefender.log",
  "log_level": "info",
  "log_mode": "File",
  "service_state": "Active",
  "fortress_mode": false,
  "whitelist": ["127.0.0.1", "::1"],
  "realtime_stats": false,
  "display_realtime_stats": false,
  "allowed_ports": [22, 80, 443],
  "trust_threshold": 0.7,
  "region_trust_scores": {},
  "auto_block_threshold": 0.2,
  "auto_whitelist_threshold": 0.9,
  "connection_time_for_trust": 300,
  "essential_ports": [22, 80, 443]
}
```

### Options principales

| Option | Description | Valeur par d√©faut |
|--------|-------------|------------------|
| `interfaces` | Interfaces r√©seau √† surveiller | `["eth0"]` |
| `packet_threshold` | Seuil de paquets par seconde | `1000` |
| `check_interval` | Intervalle de v√©rification (secondes) | `5` |
| `block_duration` | Dur√©e de blocage (secondes) | `300` |
| `log_mode` | Mode de journalisation (`File` ou `SystemdJournal`) | `File` |
| `fortress_mode` | Mode forteresse activ√© | `false` |
| `whitelist` | IPs √† ne jamais bloquer | `["127.0.0.1", "::1"]` |
| `allowed_ports` | Ports autoris√©s lors de la s√©curisation | `[22, 80, 443]` |
| `trust_threshold` | Seuil de confiance pour consid√©rer une IP fiable | `0.7` |
| `region_trust_scores` | Scores de confiance par r√©gion | `{}` |
| `auto_block_threshold` | Seuil de confiance pour blocage automatique | `0.2` |
| `auto_whitelist_threshold` | Seuil de confiance pour mise en liste blanche auto | `0.9` |
| `connection_time_for_trust` | Dur√©e de connexion (sec) pour √™tre fiable | `300` |

## üìù Journalisation

ZDefender supporte deux modes de journalisation:

- **üìÑ Fichier**: Logs √©crits dans un fichier classique (`/var/log/zdefender/zdefender.log` par d√©faut)
- **üìä SystemdJournal**: Logs envoy√©s √† systemd-journal (n√©cessite la feature `systemd`)

### Activer le support SystemdJournal

```bash
# Compiler avec la feature systemd
cargo build --release --features systemd

# Activer dans la configuration
sudo sed -i 's/"log_mode": "File"/"log_mode": "SystemdJournal"/' /etc/zdefender/config.json
```

## üñ•Ô∏è Utilisation

### Interface CLI

```bash
# D√©marrer le service
zdefender start

# D√©marrer en daemon
zdefender start --daemon

# Arr√™ter le service
zdefender stop

# Afficher le statut
zdefender status

# Afficher les statistiques en temps r√©el (Ctrl+C pour quitter)
zdefender stats

# Afficher un rapport statique des statistiques de base
zdefender check

# Afficher les statistiques d√©taill√©es avec scores de confiance
zdefender detailed-stats

# Consulter les informations sur une IP sp√©cifique
zdefender ip-info 192.168.1.10

# Activer le mode forteresse
zdefender fortress --enable

# D√©sactiver le mode forteresse
zdefender fortress --disable

# S√©curiser rapidement le serveur
zdefender secure

# S√©curiser le serveur en sp√©cifiant les ports √† laisser ouverts
zdefender secure --ports=22,80,443,3306

# Configurer le score de confiance pour une r√©gion
zdefender configure-region FR 0.8

# Recharger la configuration
zdefender reload

# Afficher les logs
zdefender logs

# Afficher les N derni√®res lignes de logs
zdefender logs --lines=50

# Afficher uniquement les logs d'erreur
zdefender logs --level=error

# Combiner les options
zdefender logs --lines=30 --level=warn

# Configurer les param√®tres de mise √† jour
zdefender update-settings --enable          # Activer les mises √† jour automatiques
zdefender update-settings --disable         # D√©sactiver les mises √† jour automatiques
zdefender update-settings --channel=beta    # Configurer le canal des mises √† jour (stable, beta, dev)
zdefender update-settings --interval=48     # Configurer l'intervalle de v√©rification (en heures)
zdefender update-settings --check-now       # Forcer une v√©rification imm√©diate des mises √† jour
```

### Biblioth√®que

Int√©grez ZDefender dans vos applications Rust:

```rust
use zdefender::{ProtectionManager, PacketInfo, Action, LogMode};
use std::sync::Arc;
use tokio::sync::{mpsc, RwLock};

#[tokio::main]
async fn main() {
    // Initialiser les canaux de communication
    let (report_tx, mut report_rx) = mpsc::channel(100);

    // Charger la configuration
    let config = Arc::new(RwLock::new(Config::default()));

    // Initialiser le gestionnaire de protection
    let mut protection = ProtectionManager::new(config, report_tx).await;

    // Configurer les seuils de d√©tection
    protection.set_thresholds(100.0, 0.8);

    // D√©finir un score de confiance r√©gional
    protection.set_region_trust("FR", 0.8).await;

    // Traiter un paquet
    if let Some(action) = protection.process_packet(packet) {
        match action {
            Action::Drop => println!("Paquet supprim√©"),
            Action::Block(ip, duration) => println!("IP {} bloqu√©e pour {:?}", ip, duration),
            Action::RateLimit(ip) => println!("Limitation de d√©bit pour l'IP {}", ip),
            _ => {}
        }
    }
    
    // Activer le mode forteresse
    protection.enable_fortress_mode().await;
    
    // Consulter les statistiques de s√©curit√©
    let stats = protection.get_security_stats().await;
    println!("Score de s√©curit√©: {}", stats.average_security_score);
}
```

## üîÑ Comparer avec d'autres solutions

| Fonctionnalit√© | ZDefender | Fail2Ban | Crowdsec |
|----------------|-----------|----------|----------|
| D√©tection en temps r√©el | ‚úÖ | ‚ùå | ‚úÖ |
| Analyse comportementale | ‚úÖ | ‚ùå | ‚úÖ |
| S√©curisation automatique | ‚úÖ | ‚úÖ | ‚úÖ |
| Mode forteresse | ‚úÖ | ‚ùå | ‚ùå |
| Statistiques en temps r√©el | ‚úÖ | ‚ùå | ‚úÖ |
| Syst√®me de confiance | ‚úÖ | ‚ùå | ‚úÖ |
| √âcrit en Rust | ‚úÖ | ‚ùå | ‚ùå |
| Peut √™tre utilis√© comme lib | ‚úÖ | ‚ùå | ‚úÖ |
| Analyses personnalis√©es | ‚úÖ | ‚úÖ | ‚úÖ |
| Protection DDoS | ‚úÖ | ‚ùå | ‚úÖ |

## üìú Licence

Ce projet est sous licence MIT - voir le fichier LICENSE pour plus de d√©tails. 